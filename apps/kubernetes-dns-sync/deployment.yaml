---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kubernetes-dns-sync
spec:
  strategy:
    type: Recreate
  template:
    spec:
      serviceAccountName: kubernetes-dns-sync
      containers:
      - name: kubernetes-dns-sync
        image: kubernetes-dns-sync

        command:
        - "deno"
        - "run"
        - "--allow-net"
        - "--allow-read"
        - "--allow-env"
        - "--cert=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
        - "--cached-only"
        - "controller/mod.ts"

        securityContext:
          runAsNonRoot: true
          runAsUser: 65534
          readOnlyRootFilesystem: true
          capabilities:
            drop: ["ALL"]
